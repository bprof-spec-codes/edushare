<div *ngIf="loading" class="text-center text-secondary">Loading...</div>
<div *ngIf="error" class="alert alert-danger text-center">{{ error }}</div>

<div class="container mt-4">
  <div class="profile-container mb-3 position-relative">
    <div class="left-container">
      <img *ngIf="profile?.image?.file" [src]="getProfileImageSrc()" [alt]="profile?.fullName"
        class="rounded-circle me-3" width="50" height="50" />
      <p class="mb-0 text-center">{{profile?.fullName}}</p>
    </div>
    <div class="email">
      <p class="text-center ">{{profile?.email}}</p>
    </div>
    <button *ngIf="!loading && ownProfile" type="button" (click)="editDetail(profile!)"
      class="editbtn btn btn-outline-primary position-absolute top-0 end-0">
      <i class="bi bi-pencil-square"></i>
    </button>
  </div>
  <hr>

  <!-- Admin panel for user warn, ban -->
  <div *ngIf="isAdmin && !ownProfile && profile" class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0"><i class="bi bi-shield-fill-check me-2"></i>Admin Controls</h5>
    </div>
    <div class="card-body">
      <!-- User Status -->
      <div class="mb-3">
        <h6 class="fw-bold">User Status:</h6>
        <div class="d-flex gap-2 flex-wrap">
          <span *ngIf="profile.isWarned" class="badge bg-warning text-dark fs-6">
            <i class="bi bi-exclamation-triangle-fill me-1"></i>Warned
            <span *ngIf="profile.warnedAt"> on {{ profile.warnedAt | date:'short' }}</span>
          </span>
          <span *ngIf="profile.isBanned" class="badge bg-danger fs-6">
            <i class="bi bi-slash-circle-fill me-1"></i>Banned
            <span *ngIf="profile.bannedAt"> on {{ profile.bannedAt | date:'short' }}</span>
          </span>
          <span *ngIf="!profile.isWarned && !profile.isBanned" class="badge bg-success fs-6">
            <i class="bi bi-check-circle-fill me-1"></i>Good
          </span>
        </div>
      </div>
      <!-- Warn user -->
      <div class="d-flex gap-2 flex-wrap">
        <button *ngIf="!profile.isWarned" 
                type="button" 
                class="btn btn-warning"
                (click)="warnUser()">
          <i class="bi bi-exclamation-triangle me-1"></i>Warn User
        </button>
        <button *ngIf="profile.isWarned" 
                type="button" 
                class="btn btn-outline-warning"
                (click)="removeWarning()">
          <i class="bi bi-x-circle me-1"></i>Remove Warning
        </button>
        <!-- Ban User -->
        <button *ngIf="!profile.isBanned" 
                type="button" 
                class="btn btn-danger"
                (click)="banUser()">
          <i class="bi bi-slash-circle me-1"></i>Ban User
        </button>
        <button *ngIf="profile.isBanned" 
                type="button" 
                class="btn btn-outline-success"
                (click)="unbanUser()">
          <i class="bi bi-check-circle me-1"></i>Unban User
        </button>
      </div>
    </div>
  </div>

  <h2>Uploaded materials by {{profile?.fullName}}: </h2>
  <div *ngIf="loading" class="text-center text-secondary">Loading...</div>
  <div *ngIf="error" class="alert alert-danger text-center">{{ error }}</div>
  <div *ngIf="!loading && (profile?.materials?.length ?? 0) > 0">
    <div class="card-list">
      <div *ngFor="let m of profile?.materials; trackBy: trackById">
        <app-material-card [m]="m">
        </app-material-card>
      </div>
    </div>
  </div>